<!-- You must include this JavaScript file -->
<script src="https://assets.crowd.aws/crowd-html-elements.js"></script>
<script src="//uniqueturker.myleott.com/lib.js" type="text/javascript"></script>
<script type="text/javascript">
(function(){
    var ut_id = "3180196b63ba5fb0b9bee7feadbdfb7b";
    if (UTWorkerLimitReached(ut_id)) {
        document.getElementById('mturk_form').style.display = 'none';
        document.getElementsByTagName('body')[0].innerHTML = "You have already completed the maximum number of HITs allowed by this requester. Please click 'Return HIT' to avoid any impact on your approval rating.";
    }
})();
</script>
<style>
.invalid {
    border-style: solid;
    border-color: #FF0000 !important;
    border-radius: 10px;
}
</style>
<!-- For the full list of available Crowd HTML Elements and their input/output documentation,
      please refer to https://docs.aws.amazon.com/sagemaker/latest/dg/sms-ui-template-reference.html -->

<!-- You must include crowd-form so that your task submits answers to MTurk -->
<crowd-form answer-format="flatten-objects">
    <!-- Use the short-instructions section for quick instructions that the Worker
    will see while working on the task. Including some basic examples of
    good and bad answers here can help get good results. You can include
    any HTML here. -->
    <short-instructions>
        <p>
            Thank you for participating in this HIT!
            For each pair of audio samples given, please assess whether you think
            the two samples could have been produced by the same speaker.
            Some of the samples may sound somewhat degraded/distorted.
            Please try to listen beyond the distortion and concentrate on identifying the voice.
            Are the two voices the same or different?
            You have the option to indicate how sure you are of your decision.
        </p>
        <p>
          For example audio samples, click on "full instructions".
        </p >
        <p>For better results, wear headphones and work in a quiet environment.</p>

    </short-instructions>

    <!-- Use the full-instructions section for more detailed instructions that the
    Worker can open while working on the task. Including more detailed
    instructions and additional examples of good and bad answers here can
    help get good results. You can include any HTML here. -->
    <full-instructions>
        <p>Listen to these examples to get an idea of how to rate:</p >
        <audio name="sample1" controls="">
	        <source src="https://tianrengao.github.io/testMOS/audio_files/instructions/washington_gt.wav" type="audio/mpeg" />
	    </audio>
	    <p>This is a real audio recording. You should give a 5</p>
        <audio name="sample2" controls="">
            <source src="https://tianrengao.github.io/testMOS/audio_files/instructions/score-1-synthesis.wav" type="audio/mpeg" />
        </audio>
        <p>This is noise/artifacts. You should give a 1</p>
    </full-instructions>

    <!--<div>-->
    <!--  <p>What is your name?</p>-->
    <!--  <crowd-input name="username" placeholder="example: Jack" required></crowd-input>-->
    <!--</div>-->

    <!--
    <div>
         Please listen carefully to each pair of audio samples, and answer whether
         you think the two samples could have been produced by the same speaker.
    </div>
    -->
    <p>Could these two audio samples have been produced by the same speaker?</p>

    <div>
        <!--<p>On a scale of 1-5, how natural is this audio?</p>-->
    <audio name="test1_1" controls="">

        <!-- Your audio file URL will be substituted for the "audio_url" variable when
               you publish a batch with an input file containing multiple audio file URLs -->
        <source src="https://tianrengao.github.io/testMOS/audio_files/tests/GT-LJ001-0173.wav" type="audio/mpeg" />
    </audio>
    <audio name="test1_2" controls="">
        <source src="https://tianrengao.github.io/testMOS/audio_files/tests/GT-LJ001-0173.wav" type="audio/mpeg" />

    </audio>
    <br />
    <crowd-radio-group>
        <crowd-radio-button name="T_T.same_sure"       value="1">Same speaker: absolutely sure</crowd-radio-button>
        <crowd-radio-button name="T_T.same_maybe"      value="2">Same speaker: not sure</crowd-radio-button>
        <crowd-radio-button name="T_T.different_maybe" value="3">Different speakers: not sure</crowd-radio-button>
        <crowd-radio-button name="T_T.different_sure"  value="4">Different speakers: absolutely sure</crowd-radio-button>
    </crowd-radio-group>
    </div>

    <div>
    <p>Could these two audio samples have been produced by the same speaker?</p>
    <audio name="test2_1" controls="">

        <!-- Your audio file URL will be substituted for the "audio_url" variable when
               you publish a batch with an input file containing multiple audio file URLs -->
        <source src="https://tianrengao.github.io/testMOS/audio_files/tests/bad-LJ001-0015.wav" type="audio/mpeg" />

    </audio>
    <audio name="test2_2" controls="">
        <source src="https://tianrengao.github.io/testMOS/audio_files/tests/bad-LJ001-0015.wav" type="audio/mpeg" />
    </audio>
    <br />
    <crowd-radio-group>
        <crowd-radio-button name="T_VC.same_sure"       value="1">Same speaker: absolutely sure</crowd-radio-button>
        <crowd-radio-button name="T_VC.same_maybe"      value="2">Same speaker: not sure</crowd-radio-button>
        <crowd-radio-button name="T_VC.different_maybe" value="3">Different speakers: not sure</crowd-radio-button>
        <crowd-radio-button name="T_VC.different_sure"  value="4">Different speakers: absolutely sure</crowd-radio-button>
    </crowd-radio-group>
    </div>

    <div>
    <p>On a scale of 1-5, how natural is this audio?</p>
    <audio name="test4" controls="">

        <!-- Your audio file URL will be substituted for the "audio_url" variable when
               you publish a batch with an input file containing multiple audio file URLs -->
        <source src="https://tianrengao.github.io/testMOS/audio_files/tests/bad-LJ001-0051.wav" type="audio/mpeg" />

    </audio>
    <crowd-slider name="bad-LJ001-0051" min="1" max="5" step="1" pin="true" required></crowd-slider>
    </div>

    <div>
    <p>On a scale of 1-5, how natural is this audio?</p>
    <audio name="test2" controls="">

        <!-- Your audio file URL will be substituted for the "audio_url" variable when
               you publish a batch with an input file containing multiple audio file URLs -->
        <source src="https://tianrengao.github.io/testMOS/audio_files/tests/GT-LJ001-0102.wav" type="audio/mpeg" />

    </audio>
    <crowd-slider name="GT-LJ001-0102" min="1" max="5" step="1" pin="true" required></crowd-slider>
    </div>

    <div>
    <p>On a scale of 1-5, how natural is this audio?</p>
    <audio id="real1" name="real1" controls="">

        <!-- Your audio file URL will be substituted for the "audio_url" variable when
               you publish a batch with an input file containing multiple audio file URLs -->
        <source id="srcreal1" src="https://tianrengao.github.io/SqueezeWaveDemo/{realexp}/{realname}.wav_synthesis.wav" type="audio/mpeg" />

    </audio>
    <crowd-slider id="sreal1" name="{realexp}-{realname}" min="1" max="5" step="1" pin="true" required></crowd-slider>
    </div>

    <div>
    <p>On a scale of 1-5, how natural is this audio?</p>
    <audio id="real2" name="real2" controls="">

        <!-- Your audio file URL will be substituted for the "audio_url" variable when
               you publish a batch with an input file containing multiple audio file URLs -->
        <source id="srcreal2" src="https://tianrengao.github.io/testMOS/audio_files/depthwise/LJ001-0096.wav_synthesis.wav" type="audio/mpeg" />

    </audio>
    <crowd-slider id="sreal2" name="dw-LJ001-0096" min="1" max="5" step="1" pin="true" required></crowd-slider>
    </div>

    <div id="hidden_div" style="display: none;">
    </div>

</crowd-form>

<script type="text/javascript">
function validateForm() {
    var groups = document.querySelectorAll("crowd-radio-group");
    var isValid = true;
    for (var i = 0; i < groups.length; i++) {
        responseGiven = false;
        var children = groups[i].children
        for (var j = 0; j < children.length; j++) {
            responseGiven = responseGiven | children[j].checked;
        }
        if (!responseGiven) {
            groups[i].className = "invalid"
            isValid = false;
        }
        else {
            groups[i].className = ""
        }
    }
    return isValid;
}
document.querySelector('crowd-form').onsubmit = function(e ) {
    if (!validateForm()) {
        e.preventDefault();
    }
}
function getRandomSubarray(arr, size) {
    var shuffled = arr.slice(0), i = arr.length, min = i - size, temp, index;
    while (i-- > min) {
        index = Math.floor((i + 1) * Math.random());
        temp = shuffled[index];
        shuffled[index] = shuffled[i];
        shuffled[i] = temp;
    }
    return shuffled.slice(min);
}
console.log('here');

var hidden_div = document.getElementById('hidden_div');
var filenames = hidden_div.innerHTML;
filenames = filenames.split(',');

// var x = [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15];
var randomSubset = getRandomSubarray(filenames, 10);

var src_reals = [];
var slider_reals = [];
for (i = 0; i < 10; i++) {
    src_reals.push(document.getElementById('srcreal' + i));
    slider_reals.push(document.getElementById('sreal' + i));
}

var base_audio_dir = 'https://tianrengao.github.io/testMOS/audio_files/';
var expname = src_reals[0].src.split("/");
expname = expname[expname.length - 2];

for (i = 0; i < 10; i++) {
    src_reals[i].src = base_audio_dir + expname + '/' + randomSubset[i];
    slider_reals[i] =  expname + '-' + randomSubset[i];

}
// audio.load();
</script>
